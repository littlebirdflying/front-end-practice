<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        body,
        html,
        #allmap {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            font-family: "微软雅黑";
        }
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=VHZH64jBho4DAlPGXZIyjmY7GEPl9GMc"></script>
    <!-- 聚合点文件 -->
    <script type="text/javascript" src="https://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
    <script type="text/javascript" src="https://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <title>地图展示</title>
</head>

<body>
    <div id="allmap"></div>
</body>

</html>
<script type="text/javascript">
    // 百度地图API功能
    var map = new BMap.Map("allmap"); // 创建Map实例
    map.centerAndZoom(new BMap.Point(112.4717, 23.0529), 11); // 初始化地图,设置中心点坐标和地图级别
    //添加地图类型控件
    map.addControl(new BMap.MapTypeControl({
        mapTypes: [
            BMAP_NORMAL_MAP,
            BMAP_HYBRID_MAP
        ]
    }));
    map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
    //添加比例尺
    map.addControl(new BMap.ScaleControl())
    //初始化打点数据
    var markers = [];
    //初始化点聚合
    var markerClusterer = new BMapLib.MarkerClusterer(map, {
        markers: markers
    });
    // 监听鼠标缩放
    map.addEventListener("zoomend", function(){
        console.log('鼠标滑轮滚动');
        // 清除聚合类
        // 添加聚合类
    })
    let page_num = 1
    function getData() {
        axios.post('http://120.76.218.173:8999/api/place_map', {
                "code": "",
                "vendor_name": "",
                "page_num": page_num,
                "page_size": 40
            })
            .then(function (response) {
                let data = response.data.data.data
                //清除以前的点
                markerClusterer.clearMarkers(markers);
                //添加数据
                data.forEach(item => {
                    let point = new BMap.Point(item.x, item.y);    
                    let marker = new BMap.Marker(point);        // 创建标注    
                    markers.push(marker)
                })
                //添加聚合点
                markerClusterer.addMarkers(markers)
                if(data.length === 40) {
                    page_num ++
                    getData()
                }
            })
            .catch(function (error) {
                console.log(error);
            });
    }
    getData()

</script>